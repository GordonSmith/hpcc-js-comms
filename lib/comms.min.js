"use strict";function endsWith(e,t,r){var n=e.toString();("number"!=typeof r||!isFinite(r)||Math.floor(r)!==r||r>n.length)&&(r=n.length),r-=t.length;var o=n.lastIndexOf(t,r);return o!==-1&&o===r}function initNodeRequest(e){_nodeRequest=e}function setTransportFactory(e){var t=exports.createTransport;return exports.createTransport=e,t}function xml2json(e){var t=new SAXStackParser;return t.parse(e),t.root}function parseXSD(e){var t=new XSDParser;return t.parse(e),t.schema}function isArray(e){return"[object Array]"===Object.prototype.toString.call(e)}function pad(e,t){for(;e.length<t;)e="0"+e;return e}function fold(e,t){if(0===t.length)return e;for(var r=0;r<t.length;++r){e=(e<<5)-e+t.charCodeAt(r),e|=0}return e<0?e*-2:e}function foldObject(e,t,r){return Object.keys(t).sort().reduce(function(e,n){return foldValue(e,t[n],n,r)},e)}function foldValue(e,t,r,n){var o=fold(fold(fold(e,r),toString(t)),typeof t);return null===t?fold(o,"null"):void 0===t?fold(o,"undefined"):"object"==typeof t?n.indexOf(t)!==-1?fold(o,"[Circular]"+r):(n.push(t),foldObject(o,t,n)):fold(o,t.toString())}function toString(e){return Object.prototype.toString.call(e)}function hashSum(e){return pad(foldValue(0,e,"",[]).toString(16),8)}function inner(e,t){if(void 0!==e&&void 0!==t){for(var r=0,n=e.split(".");r<n.length;r++){var o=n[r];if(!t.hasOwnProperty(o))return;t=t[o]}return t}}function exists(e,t){return void 0!==inner(e,t)}function walkXmlJson(e,t,r){r=r||[],r.push(e),t(e.name,e.attributes,e.children,r),e.children.forEach(function(e){walkXmlJson(e,t,r)}),r.pop()}function flattenAtt(e){var t={};return e.forEach(function(e){"att"===e.name&&(t[e.attributes.name]=e.attributes.value)}),t}function createXGMMLGraph(e,t){var r=new XGMMLGraph(e),n=[r];walkXmlJson(t,function(e,t,o,i){var u=n[n.length-1];switch(e){case"graph":break;case"node":if(o.length&&o[0].children.length&&"graph"===o[0].children[0].name){var s=new Subgraph(u,"graph"+t.id,flattenAtt(o));r.allSubgraphs[s.id]=s,n.push(s)}else{var a=new Vertex(u,t.id,t.label,flattenAtt(o));r.allVertices[a.id]=a}break;case"edge":var c=new Edge(u,t.id,t.source,t.target,flattenAtt(o));r.allEdges[c.id]=c}});for(var o in r.allEdges)if(r.allEdges.hasOwnProperty(o)){var i=r.allEdges[o];try{i.source=r.allVertices[i.sourceID],i.target=r.allVertices[i.targetID],i.source.outEdges.push(i),i.target.inEdges.push(i)}catch(e){}}return r}function espTime2Seconds(e){if(!e)return 0;if(!isNaN(e))return parseFloat(e);var t=e.indexOf("ns");if(t!==-1)return parseFloat(e.substr(0,t))/1e9;var r=e.indexOf("ms");if(r!==-1)return parseFloat(e.substr(0,r))/1e3;var n=e.indexOf("s");if(n!==-1&&e.indexOf("days")===-1)return parseFloat(e.substr(0,n));for(var o=e.split(" days "),i=parseFloat(o.length>1?o[0]:0),u=o.length>1?o[1]:o[0],s=0,a=u.split(":").reverse(),c=0;c<a.length;++c)s+=parseFloat(a[c])*Math.pow(60,c);return 24*i*60*60+s}Object.defineProperty(exports,"__esModule",{value:!0});var xmldom=require("xmldom"),nodeRequest=require("request"),tslib_1=require("tslib"),root=new Function("try {return global;}catch(e){return window;}")(),Transport=function(){function e(e){this.opts({baseUrl:e})}return e.prototype.opts=function(e){return 0===arguments.length?this._opts:(this._opts=tslib_1.__assign({},this._opts,e),this)},e.prototype.serialize=function(e){var t=[];for(var r in e)e.hasOwnProperty(r)&&t.push(encodeURIComponent(r)+"="+encodeURIComponent(e[r]));return t.join("&")},e.prototype.deserialize=function(e){return JSON.parse(e)},e.prototype.stripSlashes=function(e){for(;0===e.indexOf("/");)e=e.substring(1);for(;endsWith(e,"/");)e=e.substring(0,e.length-1);return e},e.prototype.joinUrl=function(){for(var e=this,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return this.stripSlashes(this._opts.baseUrl)+"/"+t.map(function(t){return e.stripSlashes(t)}).join("/")},e}(),_nodeRequest=null,_d3Request=null,XHRTransport=function(e){function t(t,r,n,o,i){void 0===n&&(n=""),void 0===o&&(o=""),void 0===i&&(i=!0);var u=e.call(this,t)||this;return u.verb=r,u.userID=n,u.password=o,u.rejectUnauthorized=i,u}return tslib_1.__extends(t,e),t.prototype.nodeRequestSend=function(e,t,r){var n=this;return void 0===r&&(r="json"),new Promise(function(o,i){var u={method:n.verb,uri:n.joinUrl(e),auth:{user:n.userID,pass:n.password,sendImmediately:!0},username:n.userID,password:n.password};switch(n.verb){case"GET":u.uri+="?"+n.serialize(t);break;case"POST":u.headers={"X-Requested-With":"XMLHttpRequest","Content-Type":"application/x-www-form-urlencoded"},u.rejectUnauthorized=n.rejectUnauthorized,u.body=n.serialize(t)}_nodeRequest(u,function(e,t,u){e?i(new Error(e)):t&&200===t.statusCode?o("json"===r?n.deserialize(u):u):i(new Error(u))})})},t.prototype.d3Send=function(e,t,r){var n=this;return void 0===r&&(r="json"),new Promise(function(o,i){var u={method:n.verb,uri:n.joinUrl(e),auth:{user:n.userID,pass:n.password,sendImmediately:!0},username:n.userID,password:n.password};switch(n.verb){case"GET":u.uri+="?"+n.serialize(t);break;case"POST":u.headers={"X-Requested-With":"XMLHttpRequest","Content-Type":"application/x-www-form-urlencoded"},u.rejectUnauthorized=n.rejectUnauthorized,u.body=n.serialize(t)}var s=_d3Request(u.uri);"POST"===n.verb&&s.header("X-Requested-With","XMLHttpRequest").header("Content-Type","application/x-www-form-urlencoded").header("Origin",null),s.send(n.verb,u.body,function(e,t){e?i(new Error(e)):t&&200===t.status?o("json"===r?n.deserialize(t.responseText):t.responseText):i(new Error(t.responseText))})})},t.prototype.send=function(e,t,r){if(void 0===r&&(r="json"),_nodeRequest)return this.nodeRequestSend(e,t,r);if(_d3Request)return this.d3Send(e,t,r);throw new Error("No transport")},t}(Transport),XHRGetTransport=function(e){function t(t,r,n,o){return void 0===r&&(r=""),void 0===n&&(n=""),void 0===o&&(o=!0),e.call(this,t,"GET",r,n,o)||this}return tslib_1.__extends(t,e),t}(XHRTransport),XHRPostTransport=function(e){function t(t,r,n,o){return void 0===r&&(r=""),void 0===n&&(n=""),void 0===o&&(o=!0),e.call(this,t,"POST",r,n,o)||this}return tslib_1.__extends(t,e),t}(XHRTransport),JSONPTransport=function(e){function t(t,r){void 0===r&&(r=60);var n=e.call(this,t)||this;return n.timeout=r,n}return tslib_1.__extends(t,e),t.prototype.send=function(e,t){var r=this;return new Promise(function(n,o){function i(){delete window[s],document.body.removeChild(a)}var u=1e3*r.timeout,s="jsonp_callback_"+Math.round(999999*Math.random());window[s]=function(e){u=0,i(),n(e)};var a=document.createElement("script"),c=r.joinUrl(e);c+=c.indexOf("?")>=0?"&":"?",a.src=c+"jsonp="+s+"&"+r.serialize(t),document.body.appendChild(a);var p=setInterval(function(){u<=0?clearInterval(p):(u-=5e3)<=0&&(clearInterval(p),i(),o(Error("Request timeout:  "+a.src)))},5e3)})},t}(Transport);exports.createTransport=function(e,t){var r=new XHRPostTransport(e);return t&&r.opts(t),r};var Stack=function(){function e(){this.stack=[]}return e.prototype.push=function(e){return this.stack.push(e),e},e.prototype.pop=function(){return this.stack.pop()},e.prototype.top=function(){return this.stack.length?this.stack[this.stack.length-1]:void 0},e.prototype.depth=function(){return this.stack.length},e}(),XMLNode=function(){function e(e){this.name="",this.attributes={},this.children=[],this.content="",this.name=e.name}return e.prototype.appendAttribute=function(e,t){this.attributes[e]=t},e.prototype.appendContent=function(e){this.content+=e},e.prototype.appendChild=function(e){this.children.push(e)},e}(),SAXStackParser=function(){function e(){this.stack=new Stack}return e.prototype.walkDoc=function(e){if(this.startXMLNode({name:e.nodeName}),e.attributes)for(var t=0;t<e.attributes.length;++t){var r=e.attributes.item(t);this.attributes(r.nodeName,r.nodeValue)}if(e.childNodes)for(var t=0;t<e.childNodes.length;++t){var n=e.childNodes.item(t);n.nodeType===n.TEXT_NODE?this.characters(n.nodeValue):this.walkDoc(n)}this.endXMLNode({name:e.nodeName})},e.prototype.parse=function(e){var t=new DOMParser,r=t.parseFromString(e,"application/xml");this.startDocument(),this.walkDoc(r),this.endDocument()},e.prototype.startDocument=function(){},e.prototype.endDocument=function(){},e.prototype.startXMLNode=function(e){var t=new XMLNode(e);return this.stack.depth()?this.stack.top().appendChild(t):this.root=t,this.stack.push(t)},e.prototype.endXMLNode=function(e){return this.stack.pop()},e.prototype.attributes=function(e,t){this.stack.top().appendAttribute(e,t)},e.prototype.characters=function(e){this.stack.top().appendContent(e)},e}(),XSDNode=function(){function e(e){this.e=e}return e.prototype.fix=function(){delete this.e},e}(),XSDXMLNode=function(e){function t(t){var r=e.call(this,t)||this;return r.children=[],r}return tslib_1.__extends(t,e),t.prototype.append=function(e){this.children.push(e)},t.prototype.fix=function(){this.name=this.e.attributes.name,this.type=this.e.attributes.type;for(var t=this.children.length-1;t>=0;--t){var r=this.children[t];"Row"===r.name&&void 0===r.type&&((n=this.children).push.apply(n,r.children),this.children.splice(t,1))}e.prototype.fix.call(this);var n},t}(XSDNode),XSDSimpleType=function(e){function t(t){return e.call(this,t)||this}return tslib_1.__extends(t,e),t.prototype.append=function(e){switch(e.name){case"xs:restriction":this._restricition=e;break;case"xs:maxLength":this._maxLength=e}},t.prototype.fix=function(){this.name=this.e.attributes.name,this.type=this._restricition.attributes.base,this.maxLength=+this._maxLength.attributes.value,delete this._restricition,delete this._maxLength,e.prototype.fix.call(this)},t}(XSDNode),XSDSchema=function(){function e(){this.simpleTypes={}}return e.prototype.calcWidth=function(e,t){var r=-1;switch(e){case"xs:boolean":r=5;break;case"xs:integer":r=8;break;case"xs:nonNegativeInteger":r=8;break;case"xs:double":r=8;break;case"xs:string":r=32;break;default:for(var n="0123456789",o=e.lastIndexOf("_"),i=o>0?o:e.length,u=i-1;u>=0&&n.indexOf(e.charAt(u))!==-1;--u);u+1<i&&(r=parseInt(e.substring(u+1,i),10)),0===e.indexOf("data")&&(r*=2)}return r<t.length&&(r=t.length),r},e}(),XSDParser=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.schema=new XSDSchema,t.simpleTypes={},t.xsdStack=new Stack,t}return tslib_1.__extends(t,e),t.prototype.startXMLNode=function(t){var r=e.prototype.startXMLNode.call(this,t);switch(r.name){case"xs:element":var n=new XSDXMLNode(r);this.schema.root?this.xsdStack.depth()&&this.xsdStack.top().append(n):this.schema.root=n,this.xsdStack.push(n);break;case"xs:simpleType":this.simpleType=new XSDSimpleType(r)}return r},t.prototype.endXMLNode=function(t){var r=this.stack.top();switch(r.name){case"xs:element":this.xsdStack.pop().fix();break;case"xs:simpleType":this.simpleType.fix(),this.simpleTypes[this.simpleType.name]=this.simpleType,delete this.simpleType;break;default:this.simpleType&&this.simpleType.append(r)}return e.prototype.endXMLNode.call(this,t)},t}(SAXStackParser),ESPExceptions=function(e){function t(t,r,n){var o=e.call(this,"ESPException:  "+n.Source)||this;return o.isESPExceptions=!0,o.action=t,o.request=r,o.Source=n.Source,o.Exception=n.Exception,o}return tslib_1.__extends(t,e),t}(Error),ESPTransport=function(e){function t(t,r,n){var o=e.call(this,"")||this;return o._transport=t,o._service=r,o._version=n,o}return tslib_1.__extends(t,e),t.prototype.toESPStringArray=function(e,t){if(isArray(e[t])){for(var r=0;r<e[t].length;++r)e[t+"_i"+r]=e[t][r];delete e[t]}return e},t.prototype.send=function(e,t,r){void 0===t&&(t={}),void 0===r&&(r="json");var n=tslib_1.__assign({},t,{ver_:this._version}),o=this.joinUrl(this._service,e+".json");return this._transport.send(o,n,r).then(function(t){if("json"===r){if(t.Exceptions)throw new ESPExceptions(e,n,t.Exceptions);var o=t[("WUCDebug"===e?"WUDebug":e)+"Response"];if(!o)throw new ESPExceptions(e,n,{Source:"ESPConnection.transmit",Exception:[{Code:0,Message:"Missing Response"}]});return o}return t})},t}(Transport),WUStateID;!function(e){e[e.Unknown=0]="Unknown",e[e.Compiled=1]="Compiled",e[e.Running=2]="Running",e[e.Completed=3]="Completed",e[e.Failed=4]="Failed",e[e.Archived=5]="Archived",e[e.Aborting=6]="Aborting",e[e.Aborted=7]="Aborted",e[e.Blocked=8]="Blocked",e[e.Submitted=9]="Submitted",e[e.Scheduled=10]="Scheduled",e[e.Compiling=11]="Compiling",e[e.Wait=12]="Wait",e[e.UploadingFiled=13]="UploadingFiled",e[e.DebugPaused=14]="DebugPaused",e[e.DebugRunning=15]="DebugRunning",e[e.Paused=16]="Paused",e[e.LAST=17]="LAST",e[e.NotFound=999]="NotFound"}(WUStateID||(WUStateID={})),function(e){e[e.Unknown=0]="Unknown",e[e.Compile=1]="Compile",e[e.Check=2]="Check",e[e.Run=3]="Run",e[e.ExecuteExisting=4]="ExecuteExisting",e[e.Pause=5]="Pause",e[e.PauseNow=6]="PauseNow",e[e.Resume=7]="Resume",e[e.Debug=8]="Debug",e[e.__size=9]="__size"}(exports.WUAction||(exports.WUAction={}));var Service=function(){function e(e){"string"==typeof e&&(e=exports.createTransport(e)),this._transport=new ESPTransport(e,"WsWorkunits","1.67")}return e.prototype.WUQuery=function(e){return void 0===e&&(e={}),this._transport.send("WUQuery",e)},e.prototype.WUInfo=function(e){var t=tslib_1.__assign({Wuid:"",TruncateEclTo64k:!0,IncludeExceptions:!1,IncludeGraphs:!1,IncludeSourceFiles:!1,IncludeResults:!1,IncludeResultsViewNames:!1,IncludeVariables:!1,IncludeTimers:!1,IncludeDebugValues:!1,IncludeApplicationValues:!1,IncludeWorkflows:!1,IncludeXmlSchemas:!1,IncludeResourceURLs:!1,SuppressResultSchemas:!0},e);return this._transport.send("WUInfo",t)},e.prototype.WUCreate=function(){return this._transport.send("WUCreate")},e.prototype.objToESPArray=function(e,t,r){var n=0;for(var o in t)t.hasOwnProperty(o)&&(r[e+"s."+e+"."+n+".Name"]=o,r[e+"s."+e+"."+n+".Value"]=t[o],++n);r[e+"s."+e+".itemcount"]=n},e.prototype.WUUpdate=function(e,t,r){return void 0===t&&(t={}),void 0===r&&(r={}),this.objToESPArray("ApplicationValue",t,e),this.objToESPArray("DebugValue",r,e),this._transport.send("WUUpdate",e)},e.prototype.WUSubmit=function(e){return this._transport.send("WUSubmit",e)},e.prototype.WUResubmit=function(e){return this._transport.toESPStringArray(e,"Wuids"),this._transport.send("WUResubmit",e)},e.prototype.WUQueryDetails=function(e){return this._transport.send("WUQueryDetails",e)},e.prototype.WUListQueries=function(e){return this._transport.send("WUListQueries",e)},e.prototype.WUPushEvent=function(e){return this._transport.send("WUPushEvent",e)},e.prototype.WUAction=function(e){return this._transport.toESPStringArray(e,"Wuids"),e.ActionType=e.WUActionType,this._transport.send("WUAction",e)},e.prototype.WUGetZAPInfo=function(e){return this._transport.send("WUGetZAPInfo",e)},e.prototype.WUShowScheduled=function(e){return this._transport.send("WUShowScheduled",e)},e.prototype.WUQuerySetAliasAction=function(e){return this._transport.send("WUQuerySetAliasAction",e)},e.prototype.WUQuerySetQueryAction=function(e){return this._transport.send("WUQuerySetQueryAction",e)},e.prototype.WUPublishWorkunit=function(e){return this._transport.send("WUPublishWorkunit",e)},e.prototype.WUGetGraph=function(e){return this._transport.send("WUGetGraph",e)},e.prototype.WUResult=function(e){return this._transport.send("WUResult",e)},e.prototype.WUQueryGetGraph=function(e){return this._transport.send("WUQueryGetGraph",e)},e.prototype.WUFile=function(e){return this._transport.send("WUFile",e,"text")},e.prototype.WUGetStats=function(e){return this._transport.send("WUGetStats",e)},e.prototype.WUDetails=function(e){return this._transport.send("WUDetails",e)},e.prototype.WUCDebug=function(e){return this._transport.send("WUCDebug",e).then(function(e){var t=xml2json(e.Result);return t.children.length?t.children[0]:null})},e}(),Service$1=function(){function e(e){"string"==typeof e&&(e=exports.createTransport(e)),this._transport=new ESPTransport(e,"WsTopology","1.25")}return e.prototype.TpLogicalClusterQuery=function(e){return void 0===e&&(e={}),this._transport.send("WUUpdate",e)},e.prototype.DefaultTpLogicalClusterQuery=function(e){return void 0===e&&(e={}),this.TpLogicalClusterQuery(e).then(function(e){if(e.default)return e.default;var t,r;return e.TpLogicalClusters.TpLogicalCluster.some(function(e,n){return 0===n&&(r=e),"hthor"===e.Type&&(t=e,!0)}),t||r})},e}(),Service$2=function(){function e(e){"string"==typeof e&&(e=exports.createTransport(e)),this._transport=new ESPTransport(e,"WsSMC","1.19")}return e.prototype.Activity=function(e){return this._transport.send("Activity",e)},e}(),Service$3=function(){function e(e){"string"==typeof e&&(e=exports.createTransport(e)),this._transport=new ESPTransport(e,"WsDFU","1.35")}return e}(),ObserverHandle=function(){function e(e,t,r){this.eventTarget=e,this.eventID=t,this.callback=r}return e.prototype.release=function(){this.eventTarget.removeObserver(this.eventID,this.callback)},e.prototype.unwatch=function(){this.release()},e}(),Observable=function(){function e(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._eventObservers={},this._knownEvents=e}return e.prototype.addObserver=function(e,t){var r=this._eventObservers[e];return r||(r=[],this._eventObservers[e]=r),r.push(t),new ObserverHandle(this,e,t)},e.prototype.removeObserver=function(e,t){var r=this._eventObservers[e];if(r)for(var n=r.length-1;n>=0;--n)r[n]===t&&r.splice(n,1);return this},e.prototype.dispatchEvent=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var n=this._eventObservers[e];if(n)for(var o=0,i=n;o<i.length;o++){var u=i[o];u.apply(void 0,t)}return this},e.prototype._hasObserver=function(e){var t=this._eventObservers[e];for(var r in t)if(t[r])return!0;return!1},e.prototype.hasObserver=function(e){if(void 0!==e)return this._hasObserver(e);for(var t in this._eventObservers)if(this._hasObserver(t))return!0;return!1},e}(),StateObject=function(){function e(){this._espState={},this._espStateCache={},this._events=new Observable}return e.prototype.clear=function(e){this._espState={},this._espStateCache={},void 0!==e&&this.set(e)},e.prototype.get=function(e,t){return void 0===e?this._espState:this.has(e)?this._espState[e]:t},e.prototype.innerXXX=function(e,t){return exists(e,this._espState)?inner(e,this._espState):t},e.prototype.set=function(e,t,r){return void 0===r&&(r=!1),"string"==typeof e?this.setSingle(e,t,r):this.setAll(e)},e.prototype.setSingle=function(e,t,r){var n=this._espStateCache[e],o=hashSum(t);if(n!==o){this._espStateCache[e]=o;var i=this._espState[e];this._espState[e]=t;var u={id:e,oldValue:i,newValue:t};return r||(this._events.dispatchEvent("propChanged",u),this._events.dispatchEvent("changed",[u])),u}return null},e.prototype.setAll=function(e){var t=[];for(var r in e)if(e.hasOwnProperty(r)){var n=this.setSingle(r,e[r],!0);n&&t.push(n)}if(t.length){for(var o=0,i=t;o<i.length;o++){var u=i[o];this._events.dispatchEvent("propChanged",u)}this._events.dispatchEvent("changed",t)}return t},e.prototype.has=function(e){return void 0!==this._espState[e]},e.prototype.on=function(e,t,r){if(this.isCallback(t))switch(e){case"changed":return this._events.addObserver(e,t)}else switch(e){case"propChanged":return this._events.addObserver(e,function(e){e.id===t&&r(e)})}return this},e.prototype.isCallback=function(e){return"function"==typeof e},e.prototype.hasEventListener=function(){return this._events.hasObserver()},e}(),Cache=function(){function e(e){this._cache={},this._calcID=e}return e.hash=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return hashSum(tslib_1.__assign({},e))},e.prototype.has=function(e){return this._calcID(e)in this._cache},e.prototype.set=function(e){return this._cache[this._calcID(e)]=e,e},e.prototype.get=function(e,t){var r=this._cache[this._calcID(e)];return r?r:this.set(t())},e}(),Level;!function(e){e[e.debug=0]="debug",e[e.info=1]="info",e[e.notice=2]="notice",e[e.warning=3]="warning",e[e.error=4]="error",e[e.critical=5]="critical",e[e.alert=6]="alert",e[e.emergency=7]="emergency"}(Level||(Level={}));var Logging=function(){function e(){}return e.prototype.log=function(e,t){var r=new Date,n=r.toISOString();console.log(n+" <"+Level[e]+">:  "+t)},e.prototype.debug=function(e){this.log(Level.debug,e)},e.prototype.info=function(e){this.log(Level.info,e)},e.prototype.notice=function(e){this.log(Level.notice,e)},e.prototype.warning=function(e){this.log(Level.warning,e)},e.prototype.error=function(e){this.log(Level.error,e)},e.prototype.critical=function(e){this.log(Level.critical,e)},e.prototype.alert=function(e){this.log(Level.alert,e)},e.prototype.emergency=function(e){this.log(Level.emergency,e)},e}(),logger=new Logging,Graph=function(e){function t(t,r,n,o){var i=e.call(this)||this;i.connection=t instanceof Service?t:new Service(t);for(var u=0,s=0,a=o;s<a.length;s++){var c=a[s];if(c.GraphName===n.Name&&!c.HasSubGraphId){u=Math.round(1e3*c.Seconds)/1e3;break}}return i.set(tslib_1.__assign({Wuid:r,Time:u},n)),i}return tslib_1.__extends(t,e),Object.defineProperty(t.prototype,"properties",{get:function(){return this.get()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Wuid",{get:function(){return this.get("Wuid")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Name",{get:function(){return this.get("Name")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Label",{get:function(){return this.get("Label")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Type",{get:function(){return this.get("Type")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Complete",{get:function(){return this.get("Complete")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"WhenStarted",{get:function(){return this.get("WhenStarted")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"WhenFinished",{get:function(){return this.get("WhenFinished")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Time",{get:function(){return this.get("Time")},enumerable:!0,configurable:!0}),t}(StateObject),GraphCache=function(e){function t(){return e.call(this,function(e){return Cache.hash([e.Name])})||this}return tslib_1.__extends(t,e),t}(Cache),ATTR_DEFINITION="definition",GraphItem=function(){function e(e,t,r){this.parent=e,this.id=t,this.attrs=r}return e.prototype.className=function(){return this.constructor.name},e.prototype.hasECLDefinition=function(){return void 0!==this.attrs[ATTR_DEFINITION]},e.prototype.getECLDefinition=function(){var e=/([a-z]:\\(?:[-\w\.\d]+\\)*(?:[-\w\.\d]+)?|(?:\/[\w\.\-]+)+)\((\d*),(\d*)\)/.exec(this.attrs[ATTR_DEFINITION]);if(e){var t=e[1],r=e[2],n=e[3];return t.replace("/./","/"),{id:this.id,file:t,line:+r,column:+n}}throw"Bad definition:  "+this.attrs[ATTR_DEFINITION]},e}(),Subgraph=function(e){function t(t,r,n){var o=e.call(this,t,r,n)||this;return o.subgraphs=[],o.subgraphsMap={},o.vertices=[],o.verticesMap={},o.edges=[],o.edgesMap={},t&&t.addSubgraph(o),o}return tslib_1.__extends(t,e),t.prototype.addSubgraph=function(e){if(void 0!==this.subgraphsMap[e.id])throw"Subgraph already exists";this.subgraphsMap[e.id]=e,this.subgraphs.push(e)},t.prototype.addVertex=function(e){if(void 0!==this.verticesMap[e.id])throw"Vertex already exists";this.verticesMap[e.id]=e,this.vertices.push(e)},t.prototype.addEdge=function(e){if(void 0!==this.edgesMap[e.id])throw"Edge already exists";this.edgesMap[e.id]=e,this.edges.push(e)},t.prototype.getNearestDefinition=function(e){if(void 0===e&&(e=!0),this.hasECLDefinition())return this.getECLDefinition();if(e)for(var t=this.vertices.length-1;t>=0;--t){var r=this.vertices[t];if(r.hasECLDefinition())return r.getECLDefinition()}var n;return this.vertices.some(function(e){return!!(n=e.getNearestDefinition())}),n},t}(GraphItem),Vertex=function(e){function t(t,r,n,o){var i=e.call(this,t,r,o)||this;return i.inEdges=[],i.outEdges=[],i.label=n,t.addVertex(i),i}return tslib_1.__extends(t,e),t.prototype.getNearestDefinition=function(){if(this.hasECLDefinition())return this.getECLDefinition();var e;return this.inEdges.some(function(t){return!!(e=t.getNearestDefinition())}),e},t}(GraphItem),XGMMLGraph=function(e){function t(t){var r=e.call(this,null,t,{})||this;return r.allSubgraphs={},r.allVertices={},r.allEdges={},r}return tslib_1.__extends(t,e),t.prototype.breakpointLocations=function(e){var t=[];for(var r in this.allVertices)if(this.allVertices.hasOwnProperty(r)){var n=this.allVertices[r];if(n.hasECLDefinition()){var o=n.getECLDefinition();(o&&!e||e===o.file)&&t.push(o)}}return t.sort(function(e,t){return e.line-t.line})},t}(Subgraph),Edge=function(e){function t(t,r,n,o,i){var u=e.call(this,t,r,i)||this;return u.sourceID=n,u.targetID=o,t.addEdge(u),u}return tslib_1.__extends(t,e),t.prototype.getNearestDefinition=function(){return this.hasECLDefinition()?this.getECLDefinition():this.source.getNearestDefinition()},t}(Subgraph),Resource=function(e){function t(t,r,n){var o=e.call(this)||this;o.connection=t instanceof Service?t:new Service(t);var i=n.split("\\").join("/"),u=i.split("/"),s="res/"+r+"/",a="",c="";return 0===i.indexOf(s)&&(a=i.substr(s.length),c=u[u.length-1]),o.set({Wuid:r,URL:n,DisplayName:c,DisplayPath:a}),o}return tslib_1.__extends(t,e),Object.defineProperty(t.prototype,"properties",{get:function(){return this.get()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Wuid",{get:function(){return this.get("Wuid")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"URL",{get:function(){return this.get("URL")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"DisplayName",{get:function(){return this.get("DisplayName")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"DisplayPath",{get:function(){return this.get("DisplayPath")},enumerable:!0,configurable:!0}),t}(StateObject),Result=function(e){function t(t,r,n,o){var i=e.call(this)||this;return i.connection=t instanceof Service?t:new Service(t),i.set(tslib_1.__assign({Wuid:r,ResultViews:o},n)),i}return tslib_1.__extends(t,e),Object.defineProperty(t.prototype,"properties",{get:function(){return this.get()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Wuid",{get:function(){return this.get("Wuid")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Name",{get:function(){return this.get("Name")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Sequence",{get:function(){return this.get("Sequence")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Value",{get:function(){return this.get("Value")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Link",{get:function(){return this.get("Link")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"FileName",{get:function(){return this.get("FileName")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"IsSupplied",{get:function(){return this.get("IsSupplied")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ShowFileContent",{get:function(){return this.get("ShowFileContent")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Total",{get:function(){return this.get("Total")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ECLSchemas",{get:function(){return this.get("ECLSchemas")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"NodeGroup",{get:function(){return this.get("NodeGroup")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ResultViews",{get:function(){return this.get("ResultViews")},enumerable:!0,configurable:!0}),t.prototype.isComplete=function(){return this.Total!==-1},t.prototype.fetchXMLSchema=function(){var e=this;return this.xsdSchema?Promise.resolve(this.xsdSchema):this.WUResult().then(function(t){return exists("Result.XmlSchema.xml",t)?(e.xsdSchema=parseXSD(t.Result.XmlSchema.xml),e.xsdSchema):e})},t.prototype.fetchResult=function(){return this.WUResult(0,-1,!0).then(function(e){return exists("Result.Row",e)?e.Result.Row:[]})},t.prototype.WUResult=function(e,t,r){void 0===e&&(e=0),void 0===t&&(t=1),void 0===r&&(r=!1);var n={};return this.Wuid&&void 0!==this.Sequence?(n.Wuid=this.Wuid,n.Sequence=this.Sequence):this.Name&&this.NodeGroup?(n.LogicalName=this.Name,n.Cluster=this.NodeGroup):this.Name&&(n.LogicalName=this.Name),n.Start=e,n.Count=t,n.SuppressXmlSchema=r,this.connection.WUResult(n).then(function(e){return e})},t}(StateObject),ResultCache=function(e){function t(){return e.call(this,function(e){return Cache.hash([e.Sequence,e.Name,e.FileName])})||this}return tslib_1.__extends(t,e),t}(Cache),SourceFile=function(e){function t(t,r,n){var o=e.call(this)||this;return o.connection=t instanceof Service?t:new Service(t),o.set(tslib_1.__assign({Wuid:r},n)),o}return tslib_1.__extends(t,e),Object.defineProperty(t.prototype,"properties",{get:function(){return this.get()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Wuid",{get:function(){return this.get("Wuid")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"FileCluster",{get:function(){return this.get("FileCluster")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Name",{get:function(){return this.get("Name")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Count",{get:function(){return this.get("Count")},enumerable:!0,configurable:!0}),t}(StateObject),Timer=function(e){function t(t,r,n){var o=e.call(this)||this;o.connection=t instanceof Service?t:new Service(t);var i=espTime2Seconds(n.Value);return o.set(tslib_1.__assign({Wuid:r,Seconds:Math.round(1e3*i)/1e3,HasSubGraphId:void 0!==n.SubGraphId,XXX:!0},n)),o}return tslib_1.__extends(t,e),Object.defineProperty(t.prototype,"properties",{get:function(){return this.get()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Wuid",{get:function(){return this.get("Wuid")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Name",{get:function(){return this.get("Name")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Value",{get:function(){return this.get("Value")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Seconds",{get:function(){return this.get("Seconds")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"GraphName",{get:function(){return this.get("GraphName")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"SubGraphId",{get:function(){return this.get("SubGraphId")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"HasSubGraphId",{get:function(){return this.get("HasSubGraphId")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"count",{get:function(){return this.get("count")},enumerable:!0,configurable:!0}),t}(StateObject),WUStateID$1=WUStateID,WorkunitCache=function(e){function t(){return e.call(this,function(e){return e.Wuid})||this}return tslib_1.__extends(t,e),t}(Cache),_workunits=new WorkunitCache,Workunit=function(e){function t(t,r,n){var o=e.call(this)||this;return o._debugMode=!1,o._monitorTickCount=0,o._resultCache=new ResultCache,o._graphCache=new GraphCache,o.connection=t instanceof Service?t:new Service(t),o.topologyConnection=r instanceof Service$1?r:new Service$1(r||t),o.clearState(n),o}return tslib_1.__extends(t,e),Object.defineProperty(t.prototype,"properties",{get:function(){return this.get()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Wuid",{get:function(){return this.get("Wuid")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Owner",{get:function(){return this.get("Owner","")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Cluster",{get:function(){return this.get("Cluster","")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Jobname",{get:function(){return this.get("Jobname","")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Description",{get:function(){return this.get("Description","")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ActionEx",{get:function(){return this.get("ActionEx","")},enumerable:!0,configurable:!0}),
Object.defineProperty(t.prototype,"StateID",{get:function(){return this.get("StateID",WUStateID.Unknown)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"State",{get:function(){return WUStateID[this.StateID]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Protected",{get:function(){return this.get("Protected",!1)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Exceptions",{get:function(){return this.get("Exceptions",{ECLException:[]})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ResultViews",{get:function(){return this.get("ResultViews",[])},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ResultCount",{get:function(){return this.get("ResultCount",0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Results",{get:function(){return this.get("Results",{ECLResult:[]})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"CResults",{get:function(){var e=this;return this.Results.ECLResult.map(function(t){return e._resultCache.get(t,function(){return new Result(e.connection,e.Wuid,t,e.ResultViews)})})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"SequenceResults",{get:function(){var e={};return this.CResults.forEach(function(t){e[t.Sequence]=t}),e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Timers",{get:function(){return this.get("Timers",{ECLTimer:[]})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"CTimers",{get:function(){var e=this;return this.Timers.ECLTimer.map(function(t){return new Timer(e.connection,e.Wuid,t)})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"GraphCount",{get:function(){return this.get("GraphCount",0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Graphs",{get:function(){return this.get("Graphs",{ECLGraph:[]})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"CGraphs",{get:function(){var e=this;return this.Graphs.ECLGraph.map(function(t){return e._graphCache.get(t,function(){return new Graph(e.connection,e.Wuid,t,e.CTimers)})})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ThorLogList",{get:function(){return this.get("ThorLogList")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ResourceURLCount",{get:function(){return this.get("ResourceURLCount",0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ResourceURLs",{get:function(){return this.get("ResourceURLs",{URL:[]})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"CResourceURLs",{get:function(){var e=this;return this.ResourceURLs.URL.map(function(t){return new Resource(e.connection,e.Wuid,t)})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"TotalClusterTime",{get:function(){return this.get("TotalClusterTime","")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"DateTimeScheduled",{get:function(){return this.get("DateTimeScheduled")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"IsPausing",{get:function(){return this.get("IsPausing")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ThorLCR",{get:function(){return this.get("ThorLCR")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ApplicationValues",{get:function(){return this.get("ApplicationValues",{ApplicationValue:[]})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"HasArchiveQuery",{get:function(){return this.get("HasArchiveQuery")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"StateEx",{get:function(){return this.get("StateEx")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"PriorityClass",{get:function(){return this.get("PriorityClass")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"PriorityLevel",{get:function(){return this.get("PriorityLevel")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Snapshot",{get:function(){return this.get("Snapshot")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ResultLimit",{get:function(){return this.get("ResultLimit")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"EventSchedule",{get:function(){return this.get("EventSchedule")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"HaveSubGraphTimings",{get:function(){return this.get("HaveSubGraphTimings")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Query",{get:function(){return this.get("Query")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"HelpersCount",{get:function(){return this.get("HelpersCount",0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Helpers",{get:function(){return this.get("Helpers",{ECLHelpFile:[]})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"DebugValues",{get:function(){return this.get("DebugValues")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"AllowedClusters",{get:function(){return this.get("AllowedClusters")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ErrorCount",{get:function(){return this.get("ErrorCount",0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"WarningCount",{get:function(){return this.get("WarningCount",0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"InfoCount",{get:function(){return this.get("InfoCount",0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"AlertCount",{get:function(){return this.get("AlertCount",0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"SourceFileCount",{get:function(){return this.get("SourceFileCount",0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"SourceFiles",{get:function(){return this.get("SourceFiles",{ECLSourceFile:[]})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"CSourceFiles",{get:function(){var e=this;return this.SourceFiles.ECLSourceFile.map(function(t){return new SourceFile(e.connection,e.Wuid,t)})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"VariableCount",{get:function(){return this.get("VariableCount",0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Variables",{get:function(){return this.get("Variables",{ECLVariable:[]})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"TimerCount",{get:function(){return this.get("TimerCount",0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"HasDebugValue",{get:function(){return this.get("HasDebugValue")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ApplicationValueCount",{get:function(){return this.get("ApplicationValueCount",0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"XmlParams",{get:function(){return this.get("XmlParams")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"AccessFlag",{get:function(){return this.get("AccessFlag")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ClusterFlag",{get:function(){return this.get("ClusterFlag")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ResultViewCount",{get:function(){return this.get("ResultViewCount",0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"DebugValueCount",{get:function(){return this.get("DebugValueCount",0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"WorkflowCount",{get:function(){return this.get("WorkflowCount",0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Archived",{get:function(){return this.get("Archived")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"DebugState",{get:function(){return this.get("DebugState",{})},enumerable:!0,configurable:!0}),t.create=function(e,r){var n=new t(e,r);return n.connection.WUCreate().then(function(e){return _workunits.set(n),n.set(e.Workunit),n})},t.attach=function(e,r,n,o){var i;return e instanceof Service&&r instanceof Service$1?i=_workunits.get({Wuid:n},function(){return new t(e,r,n)}):(i=_workunits.get({Wuid:r},function(){return new t(e,r)}),o=n),o&&i.set(o),i},t.exists=function(e){return _workunits.has({Wuid:e})},t.prototype.clearState=function(e){this.clear({Wuid:e,StateID:WUStateID$1.Unknown}),this._monitorTickCount=0},t.prototype.update=function(e,t,r){var n=this;return this.connection.WUUpdate(tslib_1.__assign({},e,{Wuid:this.Wuid,StateOrig:this.State,JobnameOrig:this.Jobname,DescriptionOrig:this.Description,ProtectedOrig:this.Protected,ClusterOrig:this.Cluster,ApplicationValues:t,DebugValues:r})).then(function(e){return n.set(e.Workunit),n})},t.prototype.submit=function(e,t,r){var n=this;void 0===t&&(t=exports.WUAction.Run);var o;return o=void 0!==e?Promise.resolve(e):this.topologyConnection.DefaultTpLogicalClusterQuery().then(function(e){return e.Name}),this._debugMode=!1,t===exports.WUAction.Debug&&(t=exports.WUAction.Run,this._debugMode=!0),o.then(function(e){return n.connection.WUUpdate({Wuid:n.Wuid,Action:t,ResultLimit:r},{},{Debug:n._debugMode}).then(function(r){return n.set(r.Workunit),n._submitAction=t,n.connection.WUSubmit({Wuid:n.Wuid,Cluster:e}).then(function(){return n})})})},t.prototype.isComplete=function(){switch(this.StateID){case WUStateID$1.Compiled:return"compile"===this.ActionEx||this._submitAction===exports.WUAction.Compile;case WUStateID$1.Completed:case WUStateID$1.Failed:case WUStateID$1.Aborted:case WUStateID$1.NotFound:return!0}return!1},t.prototype.isFailed=function(){switch(this.StateID){case WUStateID$1.Failed:return!0}return!1},t.prototype.isDeleted=function(){switch(this.StateID){case WUStateID$1.NotFound:return!0}return!1},t.prototype.isDebugging=function(){switch(this.StateID){case WUStateID$1.DebugPaused:case WUStateID$1.DebugRunning:return!0}return!1},t.prototype.isRunning=function(){switch(this.StateID){case WUStateID$1.Compiled:case WUStateID$1.Running:case WUStateID$1.Aborting:case WUStateID$1.Blocked:case WUStateID$1.DebugPaused:case WUStateID$1.DebugRunning:return!0}return!1},t.prototype.setToFailed=function(){return this.WUAction("SetToFailed")},t.prototype.pause=function(){return this.WUAction("Pause")},t.prototype.pauseNow=function(){return this.WUAction("PauseNow")},t.prototype.resume=function(){return this.WUAction("Resume")},t.prototype.abort=function(){return this.WUAction("Abort")},t.prototype.delete=function(){return this.WUAction("Delete")},t.prototype.restore=function(){return this.WUAction("Restore")},t.prototype.deschedule=function(){return this.WUAction("Deschedule")},t.prototype.reschedule=function(){return this.WUAction("Reschedule")},t.prototype.refresh=function(e){var t=this;void 0===e&&(e=!1);var r=e?this.WUInfo():this.WUQuery(),n=this.debugStatus();return Promise.all([r,n]).then(function(){return t})},t.prototype.fetchResults=function(){var e=this;return this.WUInfo({IncludeResults:!0}).then(function(){return e.CResults})},t.prototype._monitor=function(){var e=this;if(this._monitorHandle||this.isComplete())return void(this._monitorTickCount=0);this._monitorHandle=setTimeout(function(){(e.hasEventListener()?e.refresh(!0):Promise.resolve(null)).then(function(){e._monitor()}),delete e._monitorHandle},this._monitorTimeoutDuraction())},t.prototype._monitorTimeoutDuraction=function(){return++this._monitorTickCount,this._monitorTickCount<=1?0:this._monitorTickCount<=3?500:this._monitorTickCount<=10?1e3:this._monitorTickCount<=20?3e3:this._monitorTickCount<=30?5e3:1e4},t.prototype.on=function(t,r,n){var o=this;if(this.isCallback(r))switch(t){case"completed":e.prototype.on.call(this,"propChanged","StateID",function(e){o.isComplete()&&r([e])});break;case"changed":e.prototype.on.call(this,t,r)}else switch(t){case"changed":e.prototype.on.call(this,t,r,n)}return this._monitor(),this},t.prototype.watch=function(t,r){var n=this;if(void 0===r&&(r=!0),"function"!=typeof t)throw new Error("Invalid Callback");r&&setTimeout(function(){var e=n.properties,r=[];for(var o in e)e.hasOwnProperty(e)&&r.push({id:o,newValue:e[o],oldValue:void 0});t(r)},0);var o=e.prototype.on.call(this,"changed",t);return this._monitor(),o},t.prototype.watchUntilComplete=function(e){var t=this;return new Promise(function(r,n){var o=t.watch(function(n){e&&e(n),t.isComplete()&&(o.release(),r(t))})})},t.prototype.watchUntilRunning=function(e){var t=this;return new Promise(function(r,n){var o=t.watch(function(n){e&&e(n),(t.isComplete()||t.isRunning())&&(o.release(),r(t))})})},t.prototype.WUQuery=function(e){var t=this;return void 0===e&&(e={}),this.connection.WUQuery(tslib_1.__assign({},e,{Wuid:this.Wuid})).then(function(e){return t.set(e.Workunits.ECLWorkunit[0]),e}).catch(function(e){if(!e.Exception.some(function(e){return 20081===e.Code&&(t.clearState(t.Wuid),t.set("StateID",WUStateID$1.NotFound),!0)}))throw logger.warning("Unexpected exception:  "),e;return{}})},t.prototype.WUCreate=function(){var e=this;return this.connection.WUCreate().then(function(t){return e.set(t.Workunit),_workunits.set(e),t})},t.prototype.WUInfo=function(e){var t=this;void 0===e&&(e={});var r=e.IncludeResults||e.IncludeResultsViewNames;return this.connection.WUInfo(tslib_1.__assign({},e,{Wuid:this.Wuid,IncludeResults:r,IncludeResultsViewNames:r,SuppressResultSchemas:!1})).then(function(e){return e.Workunit.ResourceURLCount&&(e.Workunit.ResourceURLCount=e.Workunit.ResourceURLCount-1),e.Workunit.ResourceURLs&&e.Workunit.ResourceURLs.URL&&(e.Workunit.ResourceURLs.URL=e.Workunit.ResourceURLs.URL.filter(function(e,t){return t>0})),t.set(e.Workunit),t.set({ResultViews:r?e.ResultViews:[],HelpersCount:e.Workunit.Helpers&&e.Workunit.Helpers.ECLHelpFile?e.Workunit.Helpers.ECLHelpFile.length:0}),e}).catch(function(e){if(!e.Exception.some(function(e){return 20080===e.Code&&(t.clearState(t.Wuid),t.set("StateID",WUStateID$1.NotFound),!0)}))throw logger.warning("Unexpected exception:  "),e;return{}})},t.prototype.WUAction=function(e){var t=this;return this.connection.WUAction({Wuids:[this.Wuid],WUActionType:e}).then(function(e){return t.refresh().then(function(){return t._monitor(),e})})},t.prototype.WUResubmit=function(e,t){var r=this;return this.connection.WUResubmit({Wuids:[this.Wuid],CloneWorkunit:e,ResetWorkflow:t}).then(function(e){return r.clearState(r.Wuid),r.refresh().then(function(){return r._monitor(),e})})},t.prototype.WUCDebug=function(e,t){void 0===t&&(t={});var r="";for(var n in t)t.hasOwnProperty(n)&&(r+=" "+n+"='"+t[n]+"'");return this.connection.WUCDebug({Wuid:this.Wuid,Command:"<debug:"+e+" uid='"+this.Wuid+"'"+r+"/>"}).then(function(e){return e})},t.prototype.debug=function(e,t){return this.isDebugging()?this.WUCDebug(e,t).then(function(t){return t.children.filter(function(t){return t.name===e})[0]}).catch(function(e){return Promise.resolve(null)}):Promise.resolve(null)},t.prototype.debugStatus=function(){var e=this;return this.isDebugging()?this.debug("status").then(function(t){t=t||new XMLNode("null");var r=tslib_1.__assign({},e.DebugState,t.attributes);return e.set({DebugState:r}),t}):Promise.resolve({DebugState:{state:"unknown"}})},t.prototype.debugContinue=function(e){return void 0===e&&(e=""),this.debug("continue",{mode:e})},t.prototype.debugStep=function(e){return this.debug("step",{mode:e})},t.prototype.debugPause=function(){return this.debug("interrupt")},t.prototype.debugQuit=function(){return this.debug("quit")},t.prototype.debugDeleteAllBreakpoints=function(){return this.debug("delete",{idx:0})},t.prototype.debugBreakpointResponseParser=function(e){return e.children.map(function(e){if("break"===e.name)return e.attributes})},t.prototype.debugBreakpointAdd=function(e,t,r){var n=this;return this.debug("breakpoint",{id:e,mode:t,action:r}).then(function(e){return n.debugBreakpointResponseParser(e)})},t.prototype.debugBreakpointList=function(){var e=this;return this.debug("list").then(function(t){return e.debugBreakpointResponseParser(t)})},t.prototype.debugGraph=function(){var e=this;return this._debugAllGraph&&this.DebugState._prevGraphSequenceNum===this.DebugState.graphSequenceNum?Promise.resolve(this._debugAllGraph):this.debug("graph",{name:"all"}).then(function(t){return e.DebugState._prevGraphSequenceNum=e.DebugState.graphSequenceNum,e._debugAllGraph=createXGMMLGraph(e.Wuid,t),e._debugAllGraph})},t.prototype.debugBreakpointValid=function(e){return this.debugGraph().then(function(t){return t.breakpointLocations(e)})},t.prototype.debugPrint=function(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=10),this.debug("print",{edgeID:e,startRow:t,numRows:r}).then(function(e){return e.children.map(function(e){var t={};return e.children.forEach(function(e){t[e.name]=e.content}),t})})},t}(StateObject),version="0.0.1";root.DOMParser=xmldom.DOMParser,initNodeRequest(nodeRequest),exports.version=version,exports.JSONPTransport=JSONPTransport,exports.XHRGetTransport=XHRGetTransport,exports.XHRPostTransport=XHRPostTransport,exports.setTransportFactory=setTransportFactory,exports.WsWorkunits=Service,exports.WsTopology=Service$1,exports.WsSMC=Service$2,exports.WsDFU=Service$3,exports.Workunit=Workunit,exports.Result=Result,exports.SourceFile=SourceFile,exports.Resource=Resource,exports.Timer=Timer,exports.XGMMLGraph=XGMMLGraph,exports.GraphItem=GraphItem,exports.espTime2Seconds=espTime2Seconds;
//# sourceMappingURL=comms.min.js.map
